/*! fossil-i18next 2013-09-26 */
define("fossil-i18next",["underscore","fossil","handlebars","i18next","jquery"],function(a,b,c,d){function e(a){if(!a)throw new Error(j.engine_required);if("string"!=typeof a&&(a=a.engine),"handlebars"!==a)throw new Error(j.handlebars_only);return a}function f(a,b){var c=new $.Deferred;a.waitFor(c),d.init(b.init||{},function(a){c.resolve(a)})}function g(a){if(a.i18nextNs){var b=new $.Deferred;d.loadNamespace(a.i18nextNs,function(){b.resolve()}),a.waitFor(b)}}function h(b){b.helpers=a.extend(b.helpers||{},{t:i(b.i18nextNs)})}function i(b){return function(e){var f=a.tail(arguments),g=f.pop().hash;f.length&&(g=a.extend({postProcess:"sprintf",sprintf:f},g)),window&&this!==window&&!a.isElement(this)&&(g=a.extend(g,this)),b&&(g.ns=b);var h=d.t(e,g);return new c.SafeString(h)}}var j={engine_required:"engine options is required.",handlebars_only:"Only handlebars is supported for now."};return b.Services.I18next=b.Service.extend({initialize:function(b){this.i18next=d,this.t=a.bind(d.t,d),this.engine=e(b.engine),c.registerHelper("t",i())},_doActivateApplication:function(a){f(a,this.options,this.engine),g(a),h(a,this.i18next.options.nsseparator,this.engine)},_doActivateModule:function(a){g(a),h(a,this.i18next.options.nsseparator,this.engine)},_doActivateFragment:function(a){g(a),h(a,this.i18next.options.nsseparator,this.engine)}}),b.Services.I18next});